# 规则编辑器功能说明

## 概述

为 Oblivion Desktop 添加了一个可视化的路由规则编辑模块，替代了原有的简单文本框界面，提供更友好的规则管理体验。

## 新增功能

### 1. 可视化规则编辑器 (`src/renderer/components/RuleEditor/`)

**主要特性：**

- 🎯 **直观的规则管理界面** - 每个规则都有独立的卡片显示
- ✏️ **内联编辑** - 点击编辑按钮直接修改规则
- 🔄 **规则类型支持** - 支持 Domain、IP、GeoIP、App、Range 五种规则类型
- 🎛️ **开关控制** - 每个规则可以独立启用/禁用
- 📝 **描述字段** - 为规则添加可选的描述信息
- 🔧 **默认规则** - 一键加载预设的常用规则
- 📊 **统计信息** - 显示总规则数和启用规则数

**支持的规则类型：**

- **Domain**: 域名规则 (如 `google.com`, `*.example.com`, `!blocked.com`)
- **IP**: IP地址规则 (如 `192.168.1.1`)
- **Range**: IP范围规则 (如 `192.168.0.0/24`)
- **App**: 应用程序规则 (如 `chrome.exe`)
- **GeoIP**: 地理位置规则 (如 `ir`, `cn`, `us`)

### 2. 规则管理页面 (`src/renderer/pages/Rules/`)

**主要功能：**

- 📋 **完整的规则管理界面** - 专门的页面用于管理所有路由规则
- 💾 **实时保存** - 支持 Ctrl+S 快捷键保存更改
- ↩️ **撤销功能** - 支持 Ctrl+Z 快捷键重置更改
- ℹ️ **上下文提示** - 根据当前代理模式显示相关信息
- 📚 **帮助文档** - 内置规则语法说明和示例

### 3. 导航集成

**更新内容：**

- 🧭 **新增标签页** - 在底部导航栏添加了"Rules"标签页
- 🌐 **多语言支持** - 为13种语言添加了"规则"标签的翻译
- 🔗 **路由配置** - 添加了 `/rules` 路由到应用路由系统

## 文件结构

```
src/
├── renderer/
│   ├── components/
│   │   └── RuleEditor/
│   │       ├── index.tsx          # 规则编辑器主组件
│   │       └── RuleEditor.css     # 样式文件
│   ├── pages/
│   │   └── Rules/
│   │       ├── index.tsx          # 规则管理页面
│   │       └── Rules.css          # 页面样式
│   ├── components/
│   │   └── Tabs.tsx               # 更新：添加规则标签页
│   └── routes/
│       └── index.tsx              # 更新：添加规则路由
├── localization/
│   ├── type.ts                    # 更新：添加规则标签类型
│   ├── en.ts                      # 更新：英语翻译
│   ├── fa.ts                      # 更新：波斯语翻译
│   ├── cn.ts                      # 更新：中文翻译
│   └── [其他语言文件...]           # 更新：所有语言的翻译
└── RULES_FEATURE.md               # 本说明文档
```

## 使用方法

### 1. 访问规则编辑器

- 启动应用后，点击底部导航栏的"Rules"标签页
- 或者直接访问 `/rules` 路由

### 2. 添加新规则

1. 点击"Add Rule"按钮
2. 选择规则类型（Domain、IP、GeoIP、App、Range）
3. 输入规则值（如域名、IP地址等）
4. 可选：添加描述信息
5. 点击"Add Rule"确认

### 3. 编辑现有规则

1. 点击规则卡片右侧的编辑按钮（铅笔图标）
2. 修改规则类型、值或描述
3. 点击确认按钮（✓）保存，或取消按钮（✗）放弃更改

### 4. 管理规则

- **启用/禁用**: 点击规则卡片右侧的开关按钮
- **删除规则**: 点击删除按钮（垃圾桶图标）
- **加载默认规则**: 点击"Defaults"按钮加载预设规则

### 5. 保存更改

- 点击页面顶部的"Save Changes"按钮
- 或使用快捷键 `Ctrl+S`
- 重置更改：点击"Reset"按钮或使用 `Ctrl+Z`

## 规则语法说明

### 域名规则 (Domain)

- `google.com` - 直接访问 google.com
- `*.example.com` - 匹配所有 example.com 的子域名
- `!blocked.com` - 排除规则，强制通过VPN访问

### IP规则

- `192.168.1.1` - 单个IP地址
- `192.168.0.0/24` - IP范围（CIDR表示法）

### 应用规则 (App)

- `chrome.exe` - Windows应用程序
- `Chrome` - macOS应用程序名称

### 地理位置规则 (GeoIP)

- `ir` - 伊朗IP地址
- `cn` - 中国IP地址
- `us` - 美国IP地址

## 技术实现

### 数据流

1. **加载**: 从 `electron-settings` 读取现有的 `routingRules` 配置
2. **解析**: 将字符串格式的规则解析为 `Rule[]` 对象数组
3. **编辑**: 通过可视化界面修改规则对象
4. **序列化**: 将规则对象数组转换回字符串格式
5. **保存**: 将更新后的规则保存到 `electron-settings`

### 兼容性

- 完全兼容现有的路由规则格式
- 保持与原有文本编辑器的数据格式一致
- 支持现有的规则验证逻辑

### 样式主题

- 支持亮色/暗色主题自动切换
- 响应式设计，适配不同屏幕尺寸
- 与应用整体设计风格保持一致

## 多语言支持

已为以下13种语言添加了"规则"标签页的翻译：

- 🇺🇸 English: "Rules"
- 🇮🇷 Persian: "قوانین"
- 🇨🇳 Chinese: "规则"
- 🇷🇺 Russian: "Правила"
- 🇹🇷 Turkish: "Kurallar"
- 🇮🇩 Indonesian: "Aturan"
- 🇸🇦 Arabic: "القواعد"
- 🇧🇷 Portuguese: "Regras"
- 🇻🇳 Vietnamese: "Quy tắc"
- 🇵🇰 Urdu: "قوانین"
- 🇪🇸 Spanish: "Reglas"
- 🇲🇲 Burmese: "စည်းမျဉ်းများ"
- 🇪🇹 Amharic: "กฎ"

## 后续改进建议

1. **规则模板** - 添加常用规则模板（如社交媒体、开发工具等）
2. **导入/导出** - 支持规则配置的导入导出功能
3. **规则分组** - 支持将规则按类别分组管理
4. **规则测试** - 添加规则匹配测试功能
5. **性能优化** - 对大量规则的性能优化
6. **拖拽排序** - 支持拖拽调整规则优先级

## 注意事项

1. **规则优先级**: 域名排除规则（以`!`开头）会自动排在前面
2. **代理模式**: 不同代理模式（TUN/System Proxy）下规则的应用方式不同
3. **实时生效**: 规则更改需要重新连接VPN才能生效
4. **备份建议**: 建议在大量修改规则前先备份现有配置

---

这个规则编辑器大大提升了 Oblivion Desktop 的用户体验，让路由规则的管理变得更加直观和便捷。
